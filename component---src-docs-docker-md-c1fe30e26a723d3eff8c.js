(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{BxAB:function(e,n,o){"use strict";o.r(n),o.d(n,"_frontmatter",(function(){return s})),o.d(n,"default",(function(){return c}));o("91GP"),o("rGqo"),o("yt8O"),o("Btvt"),o("RW0V"),o("FlsD"),o("q1tI");var t=o("E/Ix"),a=o("hhGP");o("qKvR");function r(){return(r=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var t in o)Object.prototype.hasOwnProperty.call(o,t)&&(e[t]=o[t])}return e}).apply(this,arguments)}var s={};void 0!==s&&s&&s===Object(s)&&Object.isExtensible(s)&&!s.hasOwnProperty("__filemeta")&&Object.defineProperty(s,"__filemeta",{configurable:!0,value:{name:"_frontmatter",filename:"src/docs/docker.md"}});var i={_frontmatter:s},m=a.a;function c(e){var n=e.components,o=function(e,n){if(null==e)return{};var o,t,a={},r=Object.keys(e);for(t=0;t<r.length;t++)o=r[t],n.indexOf(o)>=0||(a[o]=e[o]);return a}(e,["components"]);return Object(t.b)(m,r({},i,o,{components:n,mdxType:"MDXLayout"}),Object(t.b)("h2",{id:"environment-variables"},"Environment variables"),Object(t.b)("p",null,"The accepted evn vars are:"),Object(t.b)("ul",null,Object(t.b)("li",{parentName:"ul"},Object(t.b)("strong",{parentName:"li"},"DB_URL")," the mongodb database url, ",Object(t.b)("strong",{parentName:"li"},"the url must contains the database name"),", for example ",Object(t.b)("inlineCode",{parentName:"li"},"mongodb://localhost/db")),Object(t.b)("li",{parentName:"ul"},Object(t.b)("strong",{parentName:"li"},"DISABLE_GRAPHIQL")," disable graphiql endpoint"),Object(t.b)("li",{parentName:"ul"},Object(t.b)("strong",{parentName:"li"},"HIDE_ERRORS_TRACEBACK")," disables the console errors traceback, useful in production to not bloat the logs"),Object(t.b)("li",{parentName:"ul"},Object(t.b)("strong",{parentName:"li"},"GRAPHIQL_DEFAULT_QUERY")," the query showed in the graphiql panel, default is ''"),Object(t.b)("li",{parentName:"ul"},Object(t.b)("strong",{parentName:"li"},"GRAPHIQL_DEFAULT_QUERY_FILE_PATH")," the query showed in the graphiql panel, loaded inside a file"),Object(t.b)("li",{parentName:"ul"},Object(t.b)("strong",{parentName:"li"},"GRAPHIQL_DEFAULT_JWT")," the default jwt used in graphiql headers panel")),Object(t.b)("h2",{id:"compose"},"Compose"),Object(t.b)("p",null,"The docker image is hosted on docker hub and has name ",Object(t.b)("inlineCode",{parentName:"p"},"mongoke/mongoke"),", every time the container is started the python code is generated based on the configuration given at path ",Object(t.b)("inlineCode",{parentName:"p"},"/conf.yml"),".\nWhen used in docker-compose the code won't be generated unless the configuration changed, to force the regeneration use the command ",Object(t.b)("inlineCode",{parentName:"p"},"docker-compose up -V"),"\nWhen using an external schema configuration you must mount the file inside the container as a volume.\nAn example on a docker-compose file:"),Object(t.b)("pre",null,Object(t.b)("code",r({parentName:"pre"},{className:"language-yml"}),"version: '3'\n\nservices:\n    mongoke:\n        image: mongoke/mongoke\n        volumes: \n            - ./confs/testing.yaml:/conf.yml\n            - ./confs/schema:/schema\n        environment: \n            - DB_URL=mongodb://mongo/db\n    mongo:\n        image: mongo\n        logging: \n            driver: none\n")),Object(t.b)("h2",{id:"swarm"},"Swarm"),Object(t.b)("p",null,"When using with docker swarm probably you want to use configs instead of volumes to be able to deploy the containers in multiple nodes:"),Object(t.b)("pre",null,Object(t.b)("code",r({parentName:"pre"},{className:"language-yml"}),"version: '3'\nservices:\n    mongoke:\n        image: mongoke/mongoke\n        configs:\n            - conf.yml\n            - schema.graphql\n        environment: \n            - DB_URL=mongodb://mongo/db\n    mongo:\n        image: mongo\n        logging: \n            driver: none\n\nconfigs:\n    schema.graphql:\n        name: domain-${domain_sum}.graphql\n        file: schema.graphql\n    conf.yml:\n        name: mongoke_conf-${mongoke_sum}.yml\n        file: mongoke_conf.yaml\n")),Object(t.b)("p",null,"Then to deploy the swarm add the env vars for the config versioning (configs in swarm are immutable and their name must change when the config content changes)"),Object(t.b)("pre",null,Object(t.b)("code",r({parentName:"pre"},{className:"language-sh"}),"mongoke_sum=`cat mongoke_conf.yaml | md5` \\\ndomain_sum=`cat schema.graphql | md5` \\\ndocker --host ssh://your-server.com stack deploy -c stack.yml stackname\n")),Object(t.b)("h2",{id:"apollo-federation"},"Apollo Federation"),Object(t.b)("p",null,"apollo federation permits you to gllue together different graphql servers together,\nTo add together more graphql servers together you can use the docker image ",Object(t.b)("a",r({parentName:"p"},{href:"https://github.com/remorses/apollo-federation-gateway"}),Object(t.b)("inlineCode",{parentName:"a"},"xmorse/apollo-federation-gateway")),", this container acts as a gateway between your graphql servers and glue together the different schemas.\nThis approach is perfect to add mutations to your existing mongoke service.\nKeep in mind that when you change one service you have also restart the gateway to make the changes to the federated schema, this can be handled adding a ",Object(t.b)("inlineCode",{parentName:"p"},"POLL_INTERVAL")," env variable that makes the gateway scrape the schemas every tot seconds to check if some schema changed.\nAn example using docker-compose:"),Object(t.b)("pre",null,Object(t.b)("code",r({parentName:"pre"},{className:"language-yml"}),'# docker-compose.yml\nversion: \'3\'\nservices:\n    gateway:\n        image: xmorse/apollo-federation-gateway\n        ports:\n            - 8090:80\n        environment:\n            URL_0: "http://mongoke/"\n            URL_1: "http://server"\n    mongoke:\n        image: mongoke/mongoke\n        volumes: \n            - ./confs/testing.yaml:/conf.yml\n            - ./confs/schema:/schema\n        environment: \n            - DB_URL=mongodb://mongo/db\n    server:\n        build: server # your custom graphql server to handle mutations and stuff\n    mongo:\n        image: mongo\n        logging: \n            driver: none\n')))}c&&c===Object(c)&&Object.isExtensible(c)&&!c.hasOwnProperty("__filemeta")&&Object.defineProperty(c,"__filemeta",{configurable:!0,value:{name:"MDXContent",filename:"src/docs/docker.md"}}),c.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-docs-docker-md-c1fe30e26a723d3eff8c.js.map