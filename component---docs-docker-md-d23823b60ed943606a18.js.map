{"version":3,"sources":["webpack:///./docs/docker.md"],"names":["_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","props","mdxType","parentName","isMDXComponent"],"mappings":"kfAMO,IAAMA,EAAe,Q,gMAE5B,IAKMC,EAAc,CAClBD,gBAEIE,EAAYC,IACH,SAASC,EAAT,GAGZ,IAFDC,EAEC,EAFDA,WACGC,E,oIACF,mBACD,OAAO,YAACJ,EAAD,KAAeD,EAAiBK,EAAhC,CAAuCD,WAAYA,EAAYE,QAAQ,cAG5E,iBAAQ,CACN,GAAM,yBADR,yBAGA,mDACA,sBACE,kBAAIC,WAAW,MAAK,sBAAQA,WAAW,MAAnB,UAApB,8BAA8F,sBAAQA,WAAW,MAAnB,2CAA9F,iBAA4L,0BAAYA,WAAW,MAAvB,2BAC5L,kBAAIA,WAAW,MAAK,sBAAQA,WAAW,MAAnB,oBAApB,8BACA,kBAAIA,WAAW,MAAK,sBAAQA,WAAW,MAAnB,yBAApB,sFACA,kBAAIA,WAAW,MAAK,sBAAQA,WAAW,MAAnB,0BAApB,0DACA,kBAAIA,WAAW,MAAK,sBAAQA,WAAW,MAAnB,oCAApB,iEACA,kBAAIA,WAAW,MAAK,sBAAQA,WAAW,MAAnB,wBAApB,oDAEF,iBAAQ,CACN,GAAM,WADR,WAGA,8EAA6D,0BAAYA,WAAW,KAAvB,mBAA7D,+GAAwO,0BAAYA,WAAW,KAAvB,aAAxO,0IACkI,0BAAYA,WAAW,KAAvB,wBADlI,iJAIA,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,iBADZ,oUAiBL,iBAAQ,CACN,GAAM,SADR,SAGA,gKACA,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,iBADZ,6eAwBL,wLACA,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,gBADZ,sKAML,iBAAQ,CACN,GAAM,qBADR,qBAGA,wLACyE,mBAAGA,WAAW,KAAQ,CAC3F,KAAQ,0DACP,0BAAYA,WAAW,KAAvB,qCAHL,oVAKwJ,0BAAYA,WAAW,KAAvB,iBALxJ,gJAOA,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,iBADZ,goB,uLA8BTJ,EAAWK,gBAAiB","file":"component---docs-docker-md-d23823b60ed943606a18.js","sourcesContent":["import React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\n\nimport DefaultLayout from \"/Users/morse/Documents/GitHub/mongoke/node_modules/gatsby-theme-docz/src/base/Layout.js\";\nexport const _frontmatter = {};\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n  return <div {...props} />;\n};\n\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h2 {...{\n      \"id\": \"environment-variables\"\n    }}>{`Environment variables`}</h2>\n    <p>{`The accepted evn vars are:`}</p>\n    <ul>\n      <li parentName=\"ul\"><strong parentName=\"li\">{`DB_URL`}</strong>{` the mongodb database url, `}<strong parentName=\"li\">{`the url must contains the database name`}</strong>{`, for example `}<inlineCode parentName=\"li\">{`mongodb://localhost/db`}</inlineCode></li>\n      <li parentName=\"ul\"><strong parentName=\"li\">{`DISABLE_GRAPHIQL`}</strong>{` disable graphiql endpoint`}</li>\n      <li parentName=\"ul\"><strong parentName=\"li\">{`HIDE_ERRORS_TRACEBACK`}</strong>{` disables the console errors traceback, useful in production to not bloat the logs`}</li>\n      <li parentName=\"ul\"><strong parentName=\"li\">{`GRAPHIQL_DEFAULT_QUERY`}</strong>{` the query showed in the graphiql panel, default is ''`}</li>\n      <li parentName=\"ul\"><strong parentName=\"li\">{`GRAPHIQL_DEFAULT_QUERY_FILE_PATH`}</strong>{` the query showed in the graphiql panel, loaded inside a file`}</li>\n      <li parentName=\"ul\"><strong parentName=\"li\">{`GRAPHIQL_DEFAULT_JWT`}</strong>{` the default jwt used in graphiql headers panel`}</li>\n    </ul>\n    <h2 {...{\n      \"id\": \"compose\"\n    }}>{`Compose`}</h2>\n    <p>{`The docker image is hosted on docker hub and has name `}<inlineCode parentName=\"p\">{`mongoke/mongoke`}</inlineCode>{`, every time the container is started the python code is generated based on the configuration given at path `}<inlineCode parentName=\"p\">{`/conf.yml`}</inlineCode>{`.\nWhen used in docker-compose the code won't be generated unless the configuration changed, to force the regeneration use the command `}<inlineCode parentName=\"p\">{`docker-compose up -V`}</inlineCode>{`\nWhen using an external schema configuration you must mount the file inside the container as a volume.\nAn example on a docker-compose file:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yml\"\n      }}>{`version: '3'\n\nservices:\n    mongoke:\n        image: mongoke/mongoke\n        volumes: \n            - ./confs/testing.yaml:/conf.yml\n            - ./confs/schema:/schema\n        environment: \n            - DB_URL=mongodb://mongo/db\n    mongo:\n        image: mongo\n        logging: \n            driver: none\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"swarm\"\n    }}>{`Swarm`}</h2>\n    <p>{`When using with docker swarm probably you want to use configs instead of volumes to be able to deploy the containers in multiple nodes:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yml\"\n      }}>{`version: '3'\nservices:\n    mongoke:\n        image: mongoke/mongoke\n        configs:\n            - conf.yml\n            - schema.graphql\n        environment: \n            - DB_URL=mongodb://mongo/db\n    mongo:\n        image: mongo\n        logging: \n            driver: none\n\nconfigs:\n    schema.graphql:\n        name: domain-\\${domain_sum}.graphql\n        file: schema.graphql\n    conf.yml:\n        name: mongoke_conf-\\${mongoke_sum}.yml\n        file: mongoke_conf.yaml\n`}</code></pre>\n    <p>{`Then to deploy the swarm add the env vars for the config versioning (configs in swarm are immutable and their name must change when the config content changes)`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-sh\"\n      }}>{`mongoke_sum=\\`cat mongoke_conf.yaml | md5\\` \\\\\ndomain_sum=\\`cat schema.graphql | md5\\` \\\\\ndocker --host ssh://your-server.com stack deploy -c stack.yml stackname\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"apollo-federation\"\n    }}>{`Apollo Federation`}</h2>\n    <p>{`apollo federation permits you to gllue together different graphql servers together,\nTo add together more graphql servers together you can use the docker image `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/remorses/apollo-federation-gateway\"\n      }}><inlineCode parentName=\"a\">{`xmorse/apollo-federation-gateway`}</inlineCode></a>{`, this container acts as a gateway between your graphql servers and glue together the different schemas.\nThis approach is perfect to add mutations to your existing mongoke service.\nKeep in mind that when you change one service you have also restart the gateway to make the changes to the federated schema, this can be handled adding a `}<inlineCode parentName=\"p\">{`POLL_INTERVAL`}</inlineCode>{` env variable that makes the gateway scrape the schemas every tot seconds to check if some schema changed.\nAn example using docker-compose:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yml\"\n      }}>{`# docker-compose.yml\nversion: '3'\nservices:\n    gateway:\n        image: xmorse/apollo-federation-gateway\n        ports:\n            - 8090:80\n        environment:\n            URL_0: \"http://mongoke/\"\n            URL_1: \"http://server\"\n    mongoke:\n        image: mongoke/mongoke\n        volumes: \n            - ./confs/testing.yaml:/conf.yml\n            - ./confs/schema:/schema\n        environment: \n            - DB_URL=mongodb://mongo/db\n    server:\n        build: server # your custom graphql server to handle mutations and stuff\n    mongo:\n        image: mongo\n        logging: \n            driver: none\n`}</code></pre>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"sourceRoot":""}